-- TAble wali kelas
CREATE TABLE public.wali_kelas (
    id int GENERATED BY DEFAULT AS IDENTITY,
    nama text NOT NULL,
    alamat text,
    telpon text,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    deleted_at timestamp with time zone
);

ALTER TABLE ONLY public.wali_kelas
    ADD CONSTRAINT wali_kelas_pkey PRIMARY KEY (id);

--Table kelas
CREATE TABLE public.kelas (
    id int GENERATED BY DEFAULT AS IDENTITY,
    nama text NOT NULL,
    tingkat int NOT NULL,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    deleted_at timestamp with time zone
);

ALTER TABLE ONLY public.kelas
    ADD CONSTRAINT kelas_pkey PRIMARY KEY (id);
	
-- table siswa
CREATE TABLE public.siswa (
    id int GENERATED BY DEFAULT AS IDENTITY,
    nama text NOT NULL,
	id_kelas int NOT NULL,
	id_wali_kelas int NOT NULL,
    tingkat int NOT NULL,
	alamat text,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    deleted_at timestamp with time zone
);

ALTER TABLE ONLY public.siswa
    ADD CONSTRAINT siswa_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.siswa 
ADD CONSTRAINT kelas_id_kelas_foreign FOREIGN KEY(id_kelas) REFERENCES public.kelas(id);

ALTER TABLE ONLY public.siswa 
ADD CONSTRAINT wali_id_wali_foreign FOREIGN KEY(id_wali_kelas) REFERENCES public.wali_kelas(id);

-- Table MAta Pelajaran
CREATE TABLE public.mata_pelajaran(
    id int GENERATED BY DEFAULT AS IDENTITY,
    nama text NOT NULL,
    kode text NOT NULL,
    tingkat int NOT NULL,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    deleted_at timestamp with time zone 
);

ALTER TABLE ONLY public.mata_pelajaran
    ADD CONSTRAINT mata_pelajaran_pkey PRIMARY KEY (id);
	
ALTER TABLE ONLY public.mata_pelajaran ADD CONSTRAINT mata_pelajaran_kode_unique UNIQUE (kode);
  
-- Jam Pelajaran
CREATE TABLE public.jam_pelajaran(
	id int GENERATED BY DEFAULT AS IDENTITY,
	id_matpel int NOT NULL,
	jam_mulai timestamp with time zone,
	jam_akhir timestamp with time zone,
	created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    deleted_at timestamp with time zone 
);

ALTER TABLE ONLY public.jam_pelajaran
    ADD CONSTRAINT jam_pelajaran_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.jam_pelajaran 
ADD CONSTRAINT matpel_id_matpel_foreign FOREIGN KEY(id_matpel) REFERENCES public.mata_pelajaran(id);

-- Table jam pelajaran siswa
CREATE TABLE public.jam_pelajaran_siswa(
	id int GENERATED BY DEFAULT AS IDENTITY,
	id_jam_pelajaran int NOT NULL,
	id_siswa int NOT NULL,
	status int NOT NULL,
	created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    deleted_at timestamp with time zone 
);

ALTER TABLE ONLY public.jam_pelajaran_siswa
    ADD CONSTRAINT jam_pelajaran_siswa_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.jam_pelajaran_siswa 
ADD CONSTRAINT jampel_id_jampel_foreign FOREIGN KEY(id_jam_pelajaran) REFERENCES public.jam_pelajaran(id);

ALTER TABLE ONLY public.jam_pelajaran_siswa 
ADD CONSTRAINT siswa_id_siswa_foreign FOREIGN KEY(id_siswa) REFERENCES public.siswa(id);
